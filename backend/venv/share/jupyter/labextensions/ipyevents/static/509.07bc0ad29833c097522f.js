"use strict";(self.webpackChunkipyevents=self.webpackChunkipyevents||[]).push([[509,983],{509:function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,o)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),o=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),o(i(797),t),o(i(792),t)},792:function(e,t,i){var s,o=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,o)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=s(e),r=0;r<i.length;r++)"default"!==i[r]&&o(t,e,i[r]);return n(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.EventModel=void 0;const a=i(983),_=i(797),l=r(i(884));let c=["altKey","ctrlKey","metaKey","shiftKey","type","timeStamp"],d=["clientX","clientY","pageX","pageY","screenX","screenY"],u=["dataX","dataY","relativeX","relativeY","boundingRectWidth","boundingRectHeight","boundingRectTop","boundingRectLeft","boundingRectBottom","boundingRectRight","arrayX","arrayY"],h=["button","buttons","layerX","layerY","movementX","movementY","offsetX","offsetY","x","y"],p=["deltaX","deltaY","deltaZ","deltaMode"],v=["changedTouches","targetTouches","touches"],f=["identifier"],g=["dataTransfer"],m=["code","key","location","repeat"],y=["tagName","id","className"],b={};class w extends a.WidgetModel{defaults(){return l.extend(super.defaults(),{_model_name:"EventModel",_model_module:"ipyevents",_model_module_version:_.EXTENSION_SPEC_VERSION,source:null,watched_events:[],ignore_modifier_key_events:!1,prevent_default_action:!1,xy_coordinate_system:null,xy:[],wait:0,throttle_or_debounce:null,_supported_mouse_events:[],_supported_key_events:[],_supported_touch_events:[],_modifier_keys:["Shift","Control","Alt","Meta"]})}initialize(e,t){super.initialize(e,t),this.on("change:source",this.prepare_source,this),this.on("change:watched_events",this.update_listeners,this),this.on("change:xy_coordinate_system",this.update_listeners,this),this.on("change:wait",this.update_listeners,this),this.on("change:throttle_or_debounce",this.update_listeners,this),this.prepare_source()}key_mouse_or_touch(e){return l.contains(this.get("_supported_mouse_events"),e)?"mouse":l.contains(this.get("_supported_key_events"),e)?"keyboard":l.contains(this.get("_supported_touch_events"),e)?"touch":void 0}_cache_listeners(e,t,i){b[this.model_id]||(b[this.model_id]=[]),b[this.model_id].push({event:e,view:t,func:i})}prepare_source(){let e=this.previous("source");this.stopListening(e);let t=this.get("source");"DOMWidgetModel"!=t.name&&("number"!=typeof t.get("_view_count")&&t.set("_view_count",0),this.listenTo(t,"change:_view_count",this.update_listeners),this.update_listeners())}update_listeners(){this.remove_listeners(),this.attach_listeners()}remove_listeners(){if(b[this.model_id])for(let e of b[this.model_id])e.view.el.removeEventListener(e.event,e.func);b[this.model_id]=null,this.get("xy").length>0&&(this.set("xy",[]),this.save_changes())}_add_listeners_to_view(e){for(let t of this.get("watched_events"))switch(this.key_mouse_or_touch(t)){case"keyboard":this._add_key_listener(t,e);break;case"touch":case"mouse":let i=this._throttle_or_debounce(this._dom_click.bind(this,e)),s=this._prevent_event_propagation.bind(this,e);e.el.addEventListener(t,i),e.el.addEventListener(t,s),this._cache_listeners(t,e,i),this._cache_listeners(t,e,s);break;default:console.error("Not familiar with that message source")}if(this.get("xy_coordinate_system")){let t=this._throttle_or_debounce(this._set_xy.bind(this,e)),i=this._prevent_event_propagation.bind(this,e),s="mousemove";e.el.addEventListener(s,t),e.el.addEventListener(s,i),this._cache_listeners(s,e,t),this._cache_listeners(s,e,i)}}attach_listeners(){let e=this.get("source");l.each(e.views,e=>{Promise.resolve(e).then(e=>{this._add_listeners_to_view(e)})})}_add_key_listener(e,t){let i=e=>{this.get("ignore_modifier_key_events")&&l.contains(this.get("_modifier_keys"),e.key)||(this._send_dom_event(e),e.stopPropagation(),e.preventDefault())},s=!0,o="ipyevents-watched",n="-4242";i=this._throttle_or_debounce(i);let r=()=>{document.addEventListener(e,i,s),t.el.focus({preventScroll:!0}),t.el!=document.activeElement&&(t.el.setAttribute("tabindex",n),t.el.focus({preventScroll:!0})),t.el.classList.add(o)},a=()=>{document.removeEventListener(e,i,s),t.el.getAttribute("tabindex")==n&&t.el.removeAttribute("tabindex"),t.el.classList.remove(o),t.el.blur()};t.el.addEventListener("mouseenter",r),t.el.addEventListener("mouseleave",a),this._cache_listeners("mouseenter",t,r),this._cache_listeners("mouseleave",t,a)}_supplement_mouse_or_touch_positions(e,t){if("touch"==this.key_mouse_or_touch(t.type))for(let i of v)for(let s of t[i])this._supplement_mouse_positions(e,s);else this._supplement_mouse_positions(e,t)}_supplement_mouse_positions(e,t){let i=function(e,t){var i=e.el.getBoundingClientRect(),s=i.top,o=i.left;return{x:Math.round(t.clientX-o),y:Math.round(t.clientY-s)}}(e,t);if(t.relativeX=i.x,t.relativeY=i.y,"_data_xy"in e){let i=e._data_xy(t);t.dataX=i.x,t.dataY=i.y}else if("ImageView"==e.model.get("_view_name")){let i=function(e,t){var i=parseInt(e.el.style.paddingLeft)||0,s=parseInt(e.el.style.borderLeft)||0,o=parseInt(e.el.style.paddingTop)||0,n=parseInt(e.el.style.borderTop)||0,r=parseInt(t.relativeX)-s-i,a=parseInt(t.relativeY)-n-o;return{x:Math.round(r/e.el.width*e.el.naturalWidth),y:Math.round(a/e.el.height*e.el.naturalHeight)}}(e,t);t.dataX=i.x,t.dataY=i.y}var s=e.el.getBoundingClientRect();t.boundingRectWidth=s.width,t.boundingRectHeight=s.height,t.boundingRectTop=s.top,t.boundingRectLeft=s.left,t.boundingRectBottom=s.bottom,t.boundingRectRight=s.right,"dataX"in t&&(t.arrayX=t.dataX,t.arrayY=t.dataY)}_dom_click(e,t){this._supplement_mouse_or_touch_positions(e,t),this._send_dom_event(t)}_set_xy(e,t){this._supplement_mouse_or_touch_positions(e,t);let i=this.get("xy_coordinate_system"),s=[t[i+"X"],t[i+"Y"]];void 0!==s[0]?(this.set("xy",s),this.save_changes()):console.error("No coordinates of this type found: "+i)}_send_dom_event(e){let t={target:{}},i=[];switch(this.key_mouse_or_touch(e.type)){case"touch":i=c.concat(v);break;case"mouse":i=c.concat(h),i=i.concat(d),i=i.concat(u),"wheel"==e.type?i=i.concat(p):("drop"==e.type||e.type.startsWith("drag"))&&(i=i.concat(g));break;case"keyboard":i=c.concat(m);break;default:console.error("Not familiar with that message source")}for(let s of i)v.includes(s)?t[s]=this._populate_touch_event_list(e[s]):t[s]=e[s];for(let i of y)t.target[i]=e.target[i];t.event=e.type,this.send(t,{})}_populate_touch_event_list(e){let t={},i=[],s=f.concat(d);s=s.concat(u);for(let o of e){for(let e of s)t[e]=o[e];i=i.concat(t)}return i}_prevent_event_propagation(e,t){("wheel"==t.type||this.get("prevent_default_action"))&&(t.preventDefault(),t.stopPropagation())}_throttle_or_debounce(e){let t=this.get("wait"),i=this.get("throttle_or_debounce");return t>0?"debounce"==i?l.debounce(e,t):l.throttle(e,t):e}}t.EventModel=w,w.serializers=Object.assign(Object.assign({},a.WidgetModel.serializers),{source:{deserialize:a.unpack_models}})},797:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EXTENSION_SPEC_VERSION=void 0,t.EXTENSION_SPEC_VERSION="2.0.4"}}]);